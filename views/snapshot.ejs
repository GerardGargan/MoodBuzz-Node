<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link href="/style.css" rel="stylesheet">
    <title>Record a snapshot</title>
</head>

<body>
    <!-- Navigation menu -->
    <%- include('user_nav'); %>

        <div class="py-sm-5 window">
            <div class="container px-0 px-sm-1">
                <div class="window-container-large px-sm-5">
                    <h2 class="mb-5">Record a new snapshot</h2>
                    <h4>Record your current level of emotion for each of the seven universal emotions.</h4>
                    <form method="GET" action="/new/snapshot">
                        <div class="row g-4 mt-3" id="insertEmotionRanges">
                            <!-- Emotion range sliders -->
                            <% var valuesArray=Object.values(groupedData); %>
                                <% valuesArray.forEach(emotion=> { %>
                                    <div class="col-xl-6 col-xxl-4 py-3 m-0">
                                        <div class="box-shadow bg-dark-subtle py-3 px-4 rounded">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <label for="<%= emotion.emotion %>" class="form-label">
                                                    <h4>Level of <%= emotion.emotion %>
                                                    </h4>
                                                    <p class="d-none d-sm-block"
                                                        id="<%= emotion.emotion_id %>_rating_desc">
                                                        <%= emotion.rating[4].shortdesc %>
                                                    </p>
                                                </label>
                                                <div>
                                                    <h3 class="bg-dark text-light p-3 rounded"
                                                        id="<%= emotion.emotion %>-val-display">5</h3>
                                                </div>
                                            </div>

                                            <input type="range" name="<%= emotion.emotion_id %>"
                                                id="<%= emotion.emotion %>" class="form-range" min="1" max="10"
                                                value="5">
                                            <div class="graduated-scale">
                                                <% emotion.rating.forEach(rating=> { %>
                                                    <span>
                                                        <%= rating.rating %>
                                                    </span>
                                                    <% }) %>
                                            </div>
                                        </div>
                                    </div>
                                    <% }); %>
                        </div>
                        <h4 class="mt-4">Select any contextual triggers</h3>
                            <div class="row mt-4">
                                <div class="d-flex gap-3 flex-wrap" id="triggers">
                                    <!-- Triggers section -->
                                    <% triggerData.forEach(trigger=> { %>
                                        <input type="checkbox" class="btn-check" name="trigger"
                                            id="<%= trigger.trigger_name %>" value="<%= trigger.trigger_id %>"
                                            autocomplete="off" unchecked>
                                        <label class="btn btn-outline-primary" for="<%= trigger.trigger_name %>">
                                            <%= trigger.trigger_name %> <i class="bi <%= trigger.icon %>"></i>
                                        </label>
                                        <% }); %>
                                </div>
                                <!-- Notes section -->
                            </div>
                            <h4 class="mt-4">Record any notes</h4>
                            <div class="row mt-4">
                                <textarea name="notes" id="notes" placeholder="Enter notes" rows="5"></textarea>
                            </div>
                            <input type="Submit" value="Save Snapshot" class="btn btn-xl btn-success mt-5">
                            <button class="btn mt-5 btn-xl btn-primary" id="resetbutton">Reset</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <%- include('footer'); %>

            <script>
                document.addEventListener('DOMContentLoaded', () => {

                    const emotionsData = <%- JSON.stringify(groupedData) %>;

                    //get all range elements on the page
                    const rangeItems2 = document.querySelectorAll('input[type="range"]');
                    //loop through each range element, add an input event listener so that when the slider is moved, we update the div showing the current number selected
                    rangeItems2.forEach((range) => {
                        range.addEventListener('input', (event) => {
                            let displayVal = document.getElementById(`${range.id}-val-display`);
                            displayVal.textContent = `${range.value}`;
                            let emotion_id = range.getAttribute('name');
                            let rating_desc_div = document.getElementById(`${emotion_id}_rating_desc`);
                            rating_desc_div.innerText = emotionsData[emotion_id].rating[range.value - 1].shortdesc;

                        });
                    });

                    //obtain the reset button, range sliders, checkboxes and notes input elements
                    const resetButton = document.getElementById('resetbutton');
                    const rangeItems = document.querySelectorAll('input[type="range"]');
                    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                    const notes = document.getElementById('notes');

                    //add an event listener to the reset button for a click event
                    resetButton.addEventListener('click', (event) => {
                        //prevent the default behaviour of a button to submit the form
                        event.preventDefault();
                        //loop through all range sliders and reset to the default of 5
                        rangeItems.forEach((rangeItem) => {
                            const valueDiv = document.getElementById(`${rangeItem.id}-val-display`);
                            rangeItem.value = 5;
                            valueDiv.innerHTML = `<h3 class="bg-dark text-light p-3 rounded">5</h3>`;
                        });

                        //reset all checkboxes to unchecked
                        checkboxes.forEach((checkbox) => {
                            checkbox.checked = false;
                        });

                        //set notes to be empty
                        notes.value = '';
                    });
                });
            </script>
            <!-- <script src="/javascript/snapshot.js"></script> -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
                crossorigin="anonymous"></script>

</body>

</html>